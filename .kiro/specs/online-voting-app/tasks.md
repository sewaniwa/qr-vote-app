# 実装計画

- [ ] 1. プロジェクト基盤とコア設定の構築
  - Next.js + TypeScript プロジェクトの初期化
  - AWS Amplify Gen2 + CDK の設定
  - 基本的なディレクトリ構造とlinting設定
  - _要件: 1.1, 2.1, 3.1_

- [ ] 2. データモデルとDynamoDBテーブルの実装
  - [ ] 2.1 DynamoDBテーブル定義の作成
    - CDKでVotingTokens、Votes、Candidates、VotingSessionsテーブルを定義
    - パーティションキー設計（votingSessionId#tokenId形式）とGSI設定
    - TTL属性とKMS暗号化の設定
    - _要件: 4.1, 4.2, 5.1, 6.1_
  
  - [ ] 2.2 TypeScript型定義とバリデーションの実装
    - データモデルのTypeScriptインターフェース作成
    - Zodを使用したスキーマバリデーション実装
    - _要件: 2.1, 3.1, 7.1_

- [ ] 3. 認証システムとQRコード処理の実装
  - [ ] 3.1 QRコード暗号化・復号化ライブラリの実装
    - AES-GCM 256 + HMAC署名による暗号化関数
    - トークン生成・検証ロジックの実装
    - 単体テストの作成
    - _要件: 1.1, 1.2, 6.1, 6.4_
  
  - [ ] 3.2 Cognito カスタム認証フローの実装
    - Lambda トリガー関数（pre-authentication, create-auth-challenge）
    - QRコードトークンによるカスタム認証チャレンジ
    - セッション管理とトークン検証
    - _要件: 1.1, 4.1, 6.4_

- [ ] 4. バックエンドAPI（Lambda関数）の実装
  - [ ] 4.1 認証API関数の実装
    - QRコードトークン検証エンドポイント（/auth/verify-qr-token）
    - DynamoDBでのトークン存在確認と使用済みフラグ更新
    - エラーハンドリングとログ記録
    - _要件: 1.1, 1.2, 4.1, 4.3_
  
  - [ ] 4.2 投票API関数の実装
    - 候補者リスト取得エンドポイント（/voting/candidates）
    - 投票送信エンドポイント（/voting/cast-vote）
    - 重複投票防止ロジック（条件付き書き込み）
    - _要件: 2.1, 3.1, 3.3, 4.1, 4.2_
  
  - [ ] 4.3 投票期間チェック機能の実装
    - 投票期間の開始・終了時刻検証
    - 期間外アクセス時のエラーレスポンス
    - _要件: 5.1, 5.2, 5.3, 5.4_

- [ ] 5. フロントエンド基盤コンポーネントの実装
  - [ ] 5.1 QRコードスキャナーコンポーネントの実装
    - react-qr-scannerライブラリの統合
    - カメラアクセス許可とエラーハンドリング
    - スキャン成功・失敗時のコールバック処理
    - _要件: 1.1, 1.2, 1.3_
  
  - [ ] 5.2 候補者リスト表示コンポーネントの実装
    - 候補者データの取得と表示
    - 単一選択UI（ラジオボタン形式）
    - レスポンシブデザインの実装
    - _要件: 2.1, 2.2, 3.1, 3.2_

- [ ] 6. 投票フロー画面の実装
  - [ ] 6.1 投票メイン画面の実装
    - QRコードスキャンから候補者選択までの統合フロー
    - 投票期間チェックと適切なメッセージ表示
    - ローディング状態とエラー状態の管理
    - _要件: 1.1, 2.1, 5.1, 5.2, 5.3_
  
  - [ ] 6.2 投票確認・送信機能の実装
    - 選択候補者の確認画面
    - 投票送信処理とIdempotency-Token実装
    - 送信成功・失敗時の適切なフィードバック
    - _要件: 3.3, 7.1, 7.2, 7.3_

- [ ] 7. エラーハンドリングとユーザー体験の向上
  - [ ] 7.1 包括的エラーハンドリングシステムの実装
    - React Error Boundaryの実装
    - エラータイプ別の日本語メッセージ定義
    - Toast通知システムの実装
    - _要件: 8.1, 8.4_
  
  - [ ] 7.2 リトライ機能とオフライン対応の実装
    - ネットワークエラー時の自動リトライ機能
    - オフライン状態の検出と適切なメッセージ表示
    - _要件: 8.3_

- [ ] 8. 管理機能の実装
  - [ ] 8.1 QRコード生成システムの実装
    - 管理者用QRコード一括生成API
    - 生成されたQRコードのCSVエクスポート機能
    - _要件: 6.1, 6.2, 6.3_
  
  - [ ] 8.2 投票期間管理機能の実装
    - 投票期間設定API
    - 投票セッション管理画面
    - _要件: 5.4_

- [ ] 9. セキュリティ強化とテストの実装
  - [ ] 9.1 セキュリティテストの実装
    - 重複投票防止テスト
    - QRコード偽造・改竄テスト
    - 不正アクセステスト
    - _要件: 4.1, 4.2, 4.3, 4.4_
  
  - [ ] 9.2 統合テストとE2Eテストの実装
    - 投票フロー全体のE2Eテスト（Playwright使用）
    - API統合テスト
    - エラーシナリオテスト
    - _要件: 全要件の統合検証_

- [ ] 10. パフォーマンス最適化とデプロイメント準備
  - [ ] 10.1 パフォーマンス最適化の実装
    - DynamoDB読み書き性能の最適化
    - Lambda関数のコールドスタート対策
    - フロントエンドバンドルサイズの最適化
    - _要件: システム全体のパフォーマンス要件_
  
  - [ ] 10.2 本番環境デプロイメント設定
    - CI/CDパイプライン（GitHub Actions）の設定
    - 環境別設定（dev/staging/prod）
    - CloudWatch監視とアラート設定
    - _要件: システム運用要件_